
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python之路【第十六篇】：Django【基础篇】 - 武沛齐 - 博客园</title>
<link type="text/css" rel="stylesheet" href="../../bundles/blog-common.css?v=03KQeESEmpLfzDqUo0NiWUg5Zd5aRam3JHBZTK05Wug1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="../../skins/SimpleBlue/bundle-SimpleBlue.css?v=jJERBFSojhmgst84aaRDal9S3q1WoO-WcNudmMzGJS81"/>
<link type="text/css" rel="stylesheet" href="../../blog/customcss/133379.css?v=YSNZANkz7eBKoXq2iHYfghvodkY%253d"/>
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="../../skins/SimpleBlue/bundle-SimpleBlue-mobile.css?v=BlWRqh78YPBjZE2nsyndTVBgXau6g8pl0IYzREPAN_U1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/wupeiqi/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/wupeiqi/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/wupeiqi/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'wupeiqi', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="../../bundles/blog-common.js?v=hH1lCMV8WaIu271Nx7jPuv36TENW9-RsSxziLxUpjtc1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/wupeiqi/">Mr.Seven</a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/wupeiqi/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/%E6%AD%A6%E6%B2%9B%E9%BD%90">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/wupeiqi/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/wupeiqi/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-124&nbsp;
文章-126&nbsp;
评论-205&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="5237704.html">Python之路【第十六篇】：Django【基础篇】</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p><span style="font-size: 14pt;">P</span>ython的WEB框架有Django、Tornado、Flask 等多种，Django相较与其他WEB框架其优势为：大而全，框架本身集成了ORM、模型绑定、模板引擎、缓存、Session等诸多功能。</p>
<h3>基本配置</h3>
<p><strong>一、创建django程序</strong></p>
<ul>
<li>终端命令：django-admin startproject sitename</li>
<li>IDE创建Django程序时，本质上都是自动执行上述命令</li>
</ul>
<p><span style="color: #888888;">其他常用命令：</span></p>
<p><span style="color: #888888;">　　python manage.py runserver 0.0.0.0</span><br /><span style="color: #888888;">　　python manage.py startapp appname</span><br /><span style="color: #888888;">　　python manage.py syncdb</span><br /><span style="color: #888888;">　　python manage.py makemigrations</span><br /><span style="color: #888888;">　　python manage.py migrate</span></p>
<p><span style="color: #888888;">　　python manage.py createsuperuser</span></p>
<p><strong>二、程序目录</strong></p>
<p><img src="http://images2015.cnblogs.com/blog/425762/201603/425762-20160306052708955-2108919642.png" alt="" width="363" height="187" /></p>
<p><strong>三、配置文件</strong></p>
<p>1、数据库</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">DATABASES = {
    'default': {
    'ENGINE': 'django.db.backends.mysql',
    'NAME':'dbname',
    'USER': 'root',
    'PASSWORD': 'xxx',
    'HOST': '',
    'PORT': '',
    }
}</pre>
</div>
<div class="cnblogs_Highlighter">
<pre class="brush:javascript;collapse:true;;gutter:true;"># 由于Django内部连接MySQL时使用的是MySQLdb模块，而python3中还无此模块，所以需要使用pymysql来代替
 
# 如下设置放置的与project同名的配置的 __init__.py文件中
 
import pymysql
pymysql.install_as_MySQLdb()　</pre>
</div>
<p>2、模版</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">TEMPLATE_DIRS = (
        os.path.join(BASE_DIR,'templates'),
    )
</pre>
</div>
<p>3、静态文件</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">STATICFILES_DIRS = (
        os.path.join(BASE_DIR,'static'),
    )
</pre>
</div>
<h3>路由系统</h3>
<p><strong>1、单一路由对应</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^index$', views.index),
</pre>
</div>
<p><strong>2、基于正则的路由</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^index/(\d*)', views.index),
url(r'^manage/(?P&lt;name&gt;\w*)/(?P&lt;id&gt;\d*)', views.manage),</pre>
</div>
<p><strong>3、添加额外的参数</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^manage/(?P&lt;name&gt;\w*)', views.manage,{'id':333}),</pre>
</div>
<p><strong>4、为路由映射设置名称</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^home', views.home, name='h1'),
url(r'^index/(\d*)', views.index, name='h2'),
</pre>
</div>
<p>设置名称之后，可以在不同的地方调用，如：</p>
<ul>
<li>模板中使用生成URL &nbsp; &nbsp; {% url 'h2' 2012 %}</li>
<li>函数中使用生成URL &nbsp; &nbsp;&nbsp;reverse('h2', args=(2012,)) &nbsp; &nbsp; &nbsp;路径:django.urls.reverse</li>
<li>Model中使用获取URL &nbsp;自定义get_absolute_url() 方法</li>
</ul>
<p><em><span style="color: #888888;">获取请求匹配成功的URL信息：request.resolver_match</span></em></p>
<p><strong>5、根据app对路由规则进行分类</strong></p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^web/',include('web.urls')),</pre>
</div>
<p><strong>6、命名空间</strong></p>
<p>a. project.urls.py</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from django.conf.urls import url,include

urlpatterns = [
    url(r'^a/', include('app01.urls', namespace='author-polls')),
    url(r'^b/', include('app01.urls', namespace='publisher-polls')),
]
</pre>
</div>
<p>b. app01.urls.py</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">from django.conf.urls import url
from app01 import views

app_name = 'app01'
urlpatterns = [
    url(r'^(?P&lt;pk&gt;\d+)/$', views.detail, name='detail')
]
</pre>
</div>
<p>c. app01.views.py</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">def detail(request, pk):
    print(request.resolver_match)
    return HttpResponse(pk)
</pre>
</div>
<p>以上定义带命名空间的url之后，使用name生成URL时候，应该如下：</p>
<ul>
<li>v = reverse('app01:detail', kwargs={'pk':11})</li>
<li>{% url 'app01:detail' pk=12 pp=99 %}</li>
</ul>
<p>django中的路由系统和其他语言的框架有所不同，在django中每一个请求的url都要有一条路由映射，这样才能将请求交给对一个的view中的函数去处理。其他大部分的Web框架则是对一类的url请求做一条路由映射，从而是路由系统变得简洁。</p>
<p>通过反射机制，为django开发一套动态的路由系统Demo：&nbsp;<strong><a href="http://files.cnblogs.com/files/wupeiqi/django_dynamic_router.rar" target="_blank">点击下载</a></strong></p>
<h3>模板</h3>
<p><strong>1、模版的执行</strong></p>
<p>模版的创建过程，对于模版，其实就是读取模版（其中嵌套着模版标签），然后将 Model 中获取的数据插入到模版中，最后将信息返回给用户。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('c043e7a5-80ad-4d05-bdec-bd3bda775755')"><img id="code_img_closed_c043e7a5-80ad-4d05-bdec-bd3bda775755" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_c043e7a5-80ad-4d05-bdec-bd3bda775755" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c043e7a5-80ad-4d05-bdec-bd3bda775755',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_c043e7a5-80ad-4d05-bdec-bd3bda775755" class="cnblogs_code_hide">
<pre><span style="color: #000000;">def current_datetime(request):
    now = datetime.datetime.now()
    html = "</span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>It is now %s.<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">" % now
    return HttpResponse(html)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('1872f58f-e803-4a91-95d1-26025f39272b')"><img id="code_img_closed_1872f58f-e803-4a91-95d1-26025f39272b" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_1872f58f-e803-4a91-95d1-26025f39272b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1872f58f-e803-4a91-95d1-26025f39272b',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_1872f58f-e803-4a91-95d1-26025f39272b" class="cnblogs_code_hide">
<pre><span style="color: #000000;">from django import template
t = template.Template('My name is {{ name }}.')
c = template.Context({'name': 'Adrian'})
print t.render(c)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('def18854-c0ec-4478-96aa-a9dcb7945849')"><img id="code_img_closed_def18854-c0ec-4478-96aa-a9dcb7945849" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_def18854-c0ec-4478-96aa-a9dcb7945849" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('def18854-c0ec-4478-96aa-a9dcb7945849',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_def18854-c0ec-4478-96aa-a9dcb7945849" class="cnblogs_code_hide">
<pre><span style="color: #000000;">import datetime
from django import template
import DjangoDemo.settings
 
now = datetime.datetime.now()
fp = open(settings.BASE_DIR+'/templates/Home/Index.html')
t = template.Template(fp.read())
fp.close()
html = t.render(template.Context({'current_date': now}))
return HttpResponse(html</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('37ab4d59-9fcd-4b6b-a22c-de8047d2cab7')"><img id="code_img_closed_37ab4d59-9fcd-4b6b-a22c-de8047d2cab7" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_37ab4d59-9fcd-4b6b-a22c-de8047d2cab7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('37ab4d59-9fcd-4b6b-a22c-de8047d2cab7',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_37ab4d59-9fcd-4b6b-a22c-de8047d2cab7" class="cnblogs_code_hide">
<pre><span style="color: #000000;">from django.template.loader import get_template
from django.template import Context
from django.http import HttpResponse
import datetime
 
def current_datetime(request):
    now = datetime.datetime.now()
    t = get_template('current_datetime.html')
    html = t.render(Context({'current_date': now}))
    return HttpResponse(html)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('7dd17bfc-e372-43e3-a7ae-f7ae7e6b3cec')"><img id="code_img_closed_7dd17bfc-e372-43e3-a7ae-f7ae7e6b3cec" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_7dd17bfc-e372-43e3-a7ae-f7ae7e6b3cec" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('7dd17bfc-e372-43e3-a7ae-f7ae7e6b3cec',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_7dd17bfc-e372-43e3-a7ae-f7ae7e6b3cec" class="cnblogs_code_hide">
<pre>return render_to_response('Account/Login.html',data,context_instance=RequestContext(request))</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong>2、模版语言</strong></p>
<p>　模板中也有自己的语言，该语言可以实现数据展示</p>
<ul>
<li>{{ item }}</li>
<li>{% for item in item_list %} &nbsp;&lt;a&gt;{{ item }}&lt;/a&gt; &nbsp;{% endfor %}<br />　　forloop.counter<br />　　forloop.first<br />　　forloop.last&nbsp;</li>
<li>{% if ordered_warranty %} &nbsp;{% else %} {% endif %}</li>
<li>母板：{% block title %}{% endblock %}<br />子板：{% extends "base.html" %}<br />　　　{% block title %}{% endblock %}</li>
<li>帮助方法：<br />{{ item.event_start|date:"Y-m-d H:i:s"}}<br />{{ bio|truncatewords:"30" }}<br />{{ my_list|first|upper }}<br />{{ name|lower }}</li>






















</ul>
<p><strong>3、自定义simple_tag</strong></p>
<p>a、在app中创建templatetags模块</p>
<p>b、创建任意 .py 文件，如：xx.py</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">#!/usr/bin/env python
#coding:utf-8
from django import template
from django.utils.safestring import mark_safe
  
register = template.Library()
  
@register.simple_tag
def my_simple_time(v1,v2,v3):
    return  v1 + v2 + v3
  
@register.simple_tag
def my_input(id,arg):
    result = "&lt;input type='text' id='%s' class='%s' /&gt;" %(id,arg,)
    return mark_safe(result)</pre>
</div>
<p>c、在使用自定义simple_tag的html文件中导入之前创建的 xx.py 文件名</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">{% load xx %}
</pre>
</div>
<p>d、使用simple_tag</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">{% my_simple_time 1 2 3%}
{% my_input 'id_username' 'hide'%}
</pre>
</div>
<p>e、在settings中配置当前app，不然django无法找到自定义的simple_tag　　</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">INSTALLED_APPS = (
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'app01',
)
</pre>
</div>
<p><em><span style="color: #888888;">更多见文档：https://docs.djangoproject.com/en/1.10/ref/templates/language/</span></em></p>
<h3>Form</h3>
<p>django中的Form一般有两种功能：</p>
<ul>
<li>输入html</li>
<li>验证用户输入</li>
</ul>
<div class="cnblogs_code" onclick="cnblogs_code_show('807b0765-b834-4428-841f-4d1791d0932e')"><img id="code_img_closed_807b0765-b834-4428-841f-4d1791d0932e" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_807b0765-b834-4428-841f-4d1791d0932e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('807b0765-b834-4428-841f-4d1791d0932e',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_807b0765-b834-4428-841f-4d1791d0932e" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> re
</span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms
</span><span style="color: #0000ff;">from</span> django.core.exceptions <span style="color: #0000ff;">import</span><span style="color: #000000;"> ValidationError


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> mobile_validate(value):
    mobile_re </span>= re.compile(r<span style="color: #800000;">'</span><span style="color: #800000;">^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> mobile_re.match(value):
        </span><span style="color: #0000ff;">raise</span> ValidationError(<span style="color: #800000;">'</span><span style="color: #800000;">手机号码格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">)


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> PublishForm(forms.Form):

    user_type_choice </span>=<span style="color: #000000;"> (
        (0, u</span><span style="color: #800000;">'</span><span style="color: #800000;">普通用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (</span>1, u<span style="color: #800000;">'</span><span style="color: #800000;">高级用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )

    user_type </span>= forms.IntegerField(widget=forms.widgets.Select(choices=<span style="color: #000000;">user_type_choice,
                                                                  attrs</span>={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">}))

    title </span>= forms.CharField(max_length=20<span style="color: #000000;">,
                            min_length</span>=5<span style="color: #000000;">,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">min_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最少为5个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">max_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最多为20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题5-20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    memo </span>= forms.CharField(required=<span style="color: #000000;">False,
                           max_length</span>=256<span style="color: #000000;">,
                           widget</span>=forms.widgets.Textarea(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control no-radius</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">详细描述</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">rows</span><span style="color: #800000;">'</span>: 3<span style="color: #000000;">}))

    phone </span>= forms.CharField(validators=<span style="color: #000000;">[mobile_validate, ],
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机号码</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    email </span>= forms.EmailField(required=<span style="color: #000000;">False,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱不能为空</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

</span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, *args, **<span style="color: #000000;">kwargs):
    super(SampleImportForm, self).</span><span style="color: #800080;">__init__</span>(*args, **<span style="color: #000000;">kwargs)

    self.fields[</span><span style="color: #800000;">'</span><span style="color: #800000;">idc</span><span style="color: #800000;">'</span>].widget.choices = models.IDC.objects.all().order_by(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>).values_list(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">display</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    self.fields[</span><span style="color: #800000;">'</span><span style="color: #800000;">business_unit</span><span style="color: #800000;">'</span>].widget.choices = models.BusinessUnit.objects.all().order_by(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>).values_list(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>)</pre>
</div>
<span class="cnblogs_code_collapse">Forms</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('eb70fbce-1bb4-4e6d-9e0a-4baafe94d463')"><img id="code_img_closed_eb70fbce-1bb4-4e6d-9e0a-4baafe94d463" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_eb70fbce-1bb4-4e6d-9e0a-4baafe94d463" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('eb70fbce-1bb4-4e6d-9e0a-4baafe94d463',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_eb70fbce-1bb4-4e6d-9e0a-4baafe94d463" class="cnblogs_code_hide">
<pre><span style="color: #000000;">def publish(request):
    ret = {'status': False, 'data': '', 'error': '', 'summary': ''}
    if request.method == 'POST':
        request_form = PublishForm(request.POST)
        if request_form.is_valid():
            request_dict = request_form.clean()
            print request_dict
            ret['status'] = True
        else:
            error_msg = request_form.errors.as_json()
            ret['error'] = json.loads(error_msg)
    return HttpResponse(json.dumps(ret))</span></pre>
</div>
<span class="cnblogs_code_collapse">Views</span></div>
<p>扩展：ModelForm</p>
<p>在使用Model和Form时，都需要对字段进行定义并指定类型，通过ModelForm则可以省去From中字段的定义</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">class AdminModelForm(forms.ModelForm):
     
    class Meta:
        model = models.Admin
        #fields = '__all__'
        fields = ('username', 'email')
         
        widgets = {
            'email' : forms.PasswordInput(attrs={'class':"alex"}),
        }</pre>
</div>
<h3>中间件</h3>
<p>django 中的中间件（middleware），在django中，中间件其实就是一个类，在请求到来和结束后，django会根据自己的规则在合适的时机执行中间件中相应的方法。</p>
<p>在django项目的settings模块中，有一个 MIDDLEWARE_CLASSES&nbsp;变量，其中每一个元素就是一个中间件，如下图。</p>
<p><img src="http://images.cnitblog.com/blog/425762/201411/102231043354970.png" alt="" /></p>
<p><em>与mange.py在同一目录下的文件夹 wupeiqi/middleware下的auth.py文件中的Authentication类</em></p>
<p>中间件中可以定义四个方法，分别是：</p>
<ul>
<li>process_request(self,request)</li>
<li>process_view(self, request, callback, callback_args, callback_kwargs)</li>
<li>process_template_response(self,request,response)</li>
<li>process_exception(self, request, exception)</li>
<li>process_response(self, request, response)</li>
</ul>
<p>以上方法的返回值可以是None和HttpResonse对象，如果是None，则继续按照django定义的规则向下执行，如果是HttpResonse对象，则直接将该对象返回给用户。</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://images.cnitblog.com/blog/425762/201411/101822420536468.png" alt="" width="413" height="364" /></p>
<h2>自定义中间件</h2>
<p>1、创建中间件类</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">class RequestExeute(object):
     
    def process_request(self,request):
        pass
    def process_view(self, request, callback, callback_args, callback_kwargs):
        i =1
        pass
    def process_exception(self, request, exception):
        pass
     
    def process_response(self, request, response):
        return response
</pre>
</div>
<p>2、注册中间件</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">MIDDLEWARE_CLASSES = (
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.auth.middleware.SessionAuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'wupeiqi.middleware.auth.RequestExeute',
)</pre>
</div>
<h3>admin</h3>
<p>django amdin是django提供的一个后台管理页面，改管理页面提供完善的html和css，使得你在通过Model创建完数据库表之后，就可以对数据进行增删改查，而使用django admin 则需要以下步骤：</p>
<ul>
<li>创建后台管理员</li>
<li>配置url</li>
<li>注册和配置django admin后台管理页面</li>
</ul>
<p>1、创建后台管理员</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">python manage.py createsuperuser
</pre>
</div>
<p>2、配置后台管理url</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;gutter:true;">url(r'^admin/', include(admin.site.urls))
</pre>
</div>
<p>3、注册和配置django admin 后台管理页面</p>
<p>a、在admin中执行如下配置</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">from django.contrib import admin
 
from app01 import  models
 
admin.site.register(models.UserType)
admin.site.register(models.UserInfo)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)</pre>
</div>
<p>b、设置数据表名称</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">class UserType(models.Model):
    name = models.CharField(max_length=50)
 
    class Meta:
        verbose_name = '用户类型'
        verbose_name_plural = '用户类型'</pre>
</div>
<p>c、打开表之后，设定默认显示，需要在model中作如下配置</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">class UserType(models.Model):
    name = models.CharField(max_length=50)
 
    def __unicode__(self):
        return self.name
</pre>
</div>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">from django.contrib import admin
 
from app01 import  models
 
class UserInfoAdmin(admin.ModelAdmin):
    list_display = ('username', 'password', 'email')
 
 
admin.site.register(models.UserType)
admin.site.register(models.UserInfo,UserInfoAdmin)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)
</pre>
</div>
<p>d、为数据表添加搜索功能</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">from django.contrib import admin
 
from app01 import  models
 
class UserInfoAdmin(admin.ModelAdmin):
    list_display = ('username', 'password', 'email')
    search_fields = ('username', 'email')
 
admin.site.register(models.UserType)
admin.site.register(models.UserInfo,UserInfoAdmin)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)</pre>
</div>
<p>e、添加快速过滤</p>
<div class="cnblogs_Highlighter">
<pre class="brush:python;collapse:true;;gutter:true;">from django.contrib import admin
 
from app01 import  models
 
class UserInfoAdmin(admin.ModelAdmin):
    list_display = ('username', 'password', 'email')
    search_fields = ('username', 'email')
    list_filter = ('username', 'email')
     
 
 
admin.site.register(models.UserType)
admin.site.register(models.UserInfo,UserInfoAdmin)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)
</pre>
</div>
<p>更多：http://docs.30c.org/djangobook2/chapter06/</p>
<p>　　</p>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2016-03-03 10:51</span> <a href='http://www.cnblogs.com/wupeiqi/'>武沛齐</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>) &nbsp;<a href="https://i.cnblogs.com/EditArticles.aspx?postid=5237704" rel="nofollow">编辑</a> <a href="5237704.html#" onclick="AddToWz(5237704);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=133379,cb_entryId=5237704,cb_blogApp=currentBlogApp,cb_blogUserGuid='7208b24d-95c9-e111-aa3f-842b2b196315',cb_entryCreatedDate='2016/3/3 10:51:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id='comment_form' class='commentform'>
<a name='commentform'></a>
<div id='divCommentShow'></div>
<div id='comment_nav'><span id='span_refresh_tips'></span><a href='javascript:void(0);' onclick='return RefreshCommentList();' id='lnk_RefreshComments' runat='server' clientidmode='Static'>刷新评论</a><a href='5237704.html#' onclick='return RefreshPage();'>刷新页面</a><a href='5237704.html#top'>返回顶部</a></div>
<div id='comment_form_container'></div>
<div class='ad_text_commentbox' id='ad_text_under_commentbox'></div>
<div id='ad_t2'></div>
<div id='opt_under_post'></div>
<div id='ad_c1' class='c_ad_block'></div>
<div id='under_post_news'></div>
<div id='ad_c2' class='c_ad_block'></div>
<div id='under_post_kb'></div>
<div id='HistoryToday' class='c_ad_block'></div>
<script type='text/javascript'>
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2016 武沛齐
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
</body>
</html>
